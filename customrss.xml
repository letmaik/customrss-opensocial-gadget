<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
	<ModulePrefs 
		title="__UP_title__" 
		title_url="__UP_titleurl__"
		directory_title="CustomRSS"		
		author="David Gurak" 
		author_email="customrss@gmail.com" 
		description="Highly customizable RSS reader to spice up your Google IG page with color and functionality. Tons of options! Capable of showing inline pictures and HTML formatting. Add the module multiple times to have color coded feeds! Recommended for advanced users only: there are lots of HTML/CSS type options in this gadget!" 
		screenshot="http://customrss.googlepages.com/customrss_preview.png"
		thumbnail="http://customrss.googlepages.com/customrss_thumbnail.png"
		height="220" 
		singleton="false"
		render_inline="never">		
		<Require feature="dynamic-height"/>
		<Require feature="analytics"/>
	</ModulePrefs>
	<UserPref name="rssurl" display_name="FEED URL" default_value="http://www.digg.com/rss/index.xml" required="true" />
	<UserPref name="title" display_name="Custom Gadget Title" default_value="CustomRSS" /> 
	<UserPref name="titleurl" display_name="Gadget Title Link" default_value="http://customrss.googlepages.com" />	
	<UserPref name="num_entries" display_name="# of Items (1-100)" default_value="10"/> 
	<UserPref name="linkaction" display_name="Link Action" default_value="Show Description" datatype="enum">
		<EnumValue value="showdescription" display_value="Show Description" /> 
		<EnumValue value="openlink" display_value="Open Link" /> 
	</UserPref>
	<UserPref name="background" 	display_name="Gadget Bkgrnd Color" 	default_value="E1E9C3"/>	
	<UserPref name="border" 		display_name="Gadget Border Color" 		default_value="CFC58E"/>
	<UserPref name="round" 			display_name="Gadget Rounded?" 		default_value="true" datatype="bool"/>			
	<UserPref name="fontfamily"		display_name="Font Family" 			default_value="Arial"/>
	<UserPref name="fontsize" 		display_name="Font Size" 			default_value="8pt"/>	
	<UserPref name="openfontsize"	display_name="Story Font Size" 		default_value="9pt"/>	
	<UserPref name="itempadding" 	display_name="Title Spacing"		default_value="3px"/>
	<UserPref name="bullet" 		display_name="Title Bullet" 		default_value="icon"	datatype="enum" >
	   <EnumValue value="" />
	   <EnumValue value="icon" display_value="favicon.ico"/>
	   <EnumValue value="bull" display_value="&#8226;"/>
	   <EnumValue value="arrows" display_value="&#187;"/>
	   <EnumValue value="middot" display_value="&#183;"/>
	   <EnumValue value="plus" display_value="+" />
	</UserPref>
	<UserPref name="custicon"	display_name="Custom Icon URL"		default_value="Overrides favicon.ico"/>
	<UserPref name="boxicon" 	display_name="Show Gadget Icon?" 		default_value="true" datatype="bool" />
	<UserPref name="opacity" 	display_name="Gadget Icon Opacity:" 	default_value="20" datatype="enum">
		<EnumValue value="100" />
		<EnumValue value="90" />
		<EnumValue value="80" />
		<EnumValue value="70" />
		<EnumValue value="60" />
		<EnumValue value="50" />
		<EnumValue value="40" />
		<EnumValue value="30" />
		<EnumValue value="20" />
		<EnumValue value="10" />
	</UserPref>		
	<UserPref name="itemlinkcolor" 	display_name="Title Link Color" 	default_value="596F3E"/>
	<UserPref name="itemlinkweight" 	display_name="Title Link Style 1" 	default_value="Normal"	datatype="enum" >
		<EnumValue value="Normal" />
		<EnumValue value="Bold" />
		<EnumValue value="Italic" />
	</UserPref>
	<UserPref name="itemlinkdecoration" display_name="Title Link Style 2"	default_value="None"	datatype="enum" >
		<EnumValue value="None" />
		<EnumValue value="Underline" />
		<EnumValue value="Strikethrough" />
	</UserPref>
	<UserPref name="vlinkcolor" 		display_name="Visited Link Color" default_value="C7CFA8"/>		
	<UserPref name="vlinkweight" 	display_name="Visited Link Style 1" 	default_value="Normal" 	datatype="enum" >
		<EnumValue value="Normal" />
		<EnumValue value="Bold" />
		<EnumValue value="Italic" />
	</UserPref>
	<UserPref name="vlinkdecoration" 	display_name="Visited Link Style 2" 	default_value="None" 	datatype="enum" >
		<EnumValue value="None" />
		<EnumValue value="Underline" />
		<EnumValue value="Strikethrough" />
	</UserPref>	
	<UserPref name="showdate"	display_name="Show Date?"	datatype="bool"		default_value="true"/>
	<UserPref name="datecolor"	display_name="Date Text Color"	default_value="9F9F9F"/>
	<UserPref name="tcolor" 	display_name="Open Title Color" 		default_value="1C57A9"/>	
	<UserPref name="thighlight" 	display_name="Open Title Bgrnd" 		default_value="FFF19D"/>
	<UserPref name="desclinkcolor" 	display_name="Open Link Color" 	default_value="1B5790"/>
	<UserPref name="color" 			display_name="Open Text Color" 	default_value="000000"/>
	<UserPref name="dback" 			display_name="Open Bgrnd Color" 	default_value="FFFFFF"/>
	<UserPref name="dborder" 		display_name="Open Border Color" 		default_value="DFCE6F"/>	
	<UserPref name="desclinkweight" 	display_name="Open Link Style 1"	default_value="Bold" 	datatype="enum" >
		<EnumValue value="Normal" />
		<EnumValue value="Bold" />
		<EnumValue value="Italic" />
	</UserPref>
	<UserPref name="desclinkdecoration" display_name="Open Link Style 2"	default_value="None" 	datatype="enum" >
		<EnumValue value="None" />
		<EnumValue value="Underline" />
		<EnumValue value="Strikethrough" />
	</UserPref>
	<Content type="html">
		<![CDATA[
			<div id='rbroundbox' class='rbroundbox'></div>			
			<script type="text/javascript">
				
				function w(t) {
					document.write(t);
				}
				
				function hex(str) {
					return str.replace(/#/g,"");
				}
			
				// Get userprefs
				var prefs = new _IG_Prefs(__MODULE_ID__);
				var showdate = prefs.getBool("show_date");
				var summary = prefs.getBool("show_summ");
				var entries = prefs.getInt("num_entries");
				var bullet = prefs.getString("bullet");
				var feedurl = prefs.getString("rssurl");
				
        if (isNaN(entries)) { entries = 10; }
				if (entries < 1) { entries = 1; }
				if (entries > 100) { entries = 100; }
				
				if (_uc(feedurl.substring(0,7)) != "HTTP://" && _uc(feedurl.substring(0,8)) != "HTTPS://") { 
					document.write("<b><font color='red'>Error:</font></b> Feed URL must begin with 'http://'"); 
				} else {
					w("<style type='text/css'>");
					w("	body {");
					w("		margin: 0px;font: 83%/1.4 arial, helvetica, sans-serif;");
					w("	} ");
					w("	");
					w("	a {");
					w("		color: " + hex(prefs.getString('itemlinkcolor')) +";");
					w("		font-weight: " + prefs.getString('itemlinkweight') +";");
					w("		text-decoration:  " + prefs.getString('itemlinkdecoration') +";");
					w("	}");
					w("	");
					w("	a:visited {");
					w("		color: " + hex(prefs.getString('vlinkcolor')) +";");
					w("		font-weight: " + prefs.getString('vlinkweight') +";");
					w("		text-decoration: " + prefs.getString('vlinkdecoration') +";");
					w("	}");
					w("	");
					w("	a:hover {");
					w("		text-decoration: underline;");
					w("	}");
					w("	a.titlelink:hover {");
					w("		background: #" + prefs.getString('thighlight') +";");
					w("		color: #" + hex(prefs.getString('tcolor')) +";");
					w("		text-decoration: none;");
					w("	}");
					w("	");
					w("	.descriptionHighlight {");
					w("		background: #" + hex(prefs.getString('dback')) +";");
					w("		border:1px solid #" + hex(prefs.getString('dborder')) +";");
					w("	}");
					w("	");
					w("	.descriptionHighlight a { font-weight: " + prefs.getString('desclinkweight') +"; color: #" + hex(prefs.getString('desclinkcolor')) +"}");
					w("	");
					w("	.description_off {");
					w("		padding: 5px 5px 5px 25px;");
					w("		display: block;");

					w("		background: #" + hex(prefs.getString('dback')) +";");
					w("		color: #" + hex(prefs.getString('color')) +";");
					w("		font-size: " + prefs.getString('openfontsize') +";");
					w("		width: 90%;");
					w("	}");
					w("	");
					w("	.description_always{");
					w("		position:relative;");
					w("		left:15px;");
					w("		padding: 5px;");
					w("		display: block;");
					w("		width:90%;");
					w("	}");
					w("");
					w("	.rbroundbox { 	background:#" + hex(prefs.getString('background')) +";");
					if (!prefs.getBool('round')) { w(" 	border:1px solid #" + hex(prefs.getString('border')) +";"); }
					w("			color: #" + hex(prefs.getString('color')) +";");
					w("			padding: 0px;");
					w("			font-family:" + prefs.getString('fontfamily') +";");
					w("			font-size:" + prefs.getString('fontsize') +";");
					w("			overflow:auto;");
					w("	}");
					w("");
					w("	.rbbot div  { background: url(http://customrss.googlepages.com/bottom-left.gif) no-repeat bottom left; }");
					w("	.rbbot      { background: url(http://customrss.googlepages.com/bottom-right.gif) no-repeat bottom right; }");
					w("");
					w("	.rbcontent      { margin: 2px 2px 0px 5px;}");
					w("	");
					w("	/* height and width details */");
					w("	.rbtop div, .rbtop, .rbbot div, .rbbot {");
					w("		width: 100%;");
					w("		height: 5px;");
					w("		font-size: 1px;");
					w("	}");
					w("");
					w("	.rbroundbox { margin: auto; }");
					w("");
					w("	.trans {");
					w("			filter:alpha(opacity=" + prefs.getString('opacity') +");");
					w("			opacity: " + (prefs.getString('opacity')*0.01) +";");
					w("			-moz-opacity:" + (prefs.getString('opacity')*0.01) +";");
					w("		}");			
					w("</style>");
					
					var favicon = feedurl.match( /:\/\/(www\.)?([^\/:]+)/ );
					favicon = favicon[2]?favicon[2]:'';
					favicon = "http://"+favicon+"/favicon.ico";
					var custicon = prefs.getString('custicon');
					if (_uc(custicon.substring(0,7))=='HTTP://' || _uc(custicon.substring(0,8))=='HTTPS://') {
						favicon=custicon;
					}
					
					switch(bullet) {
						case "bull":
							bullet = "&bull;&nbsp;&nbsp;";
							break;
						case "arrows":
							bullet = "&#187;&nbsp;&nbsp;";
							break;
						case "plus":
							bullet = "+&nbsp;&nbsp;";
							break;
						case "middot":
							bullet = "&#183;&nbsp;&nbsp;";
							break;
						case "icon":
							bullet = "favicon.ico";
							break;
						default:
							bullet = "";
							break;						
					}
					
					if (bullet == 'favicon.ico') {
						bullet = "<img src='" + favicon + "' border=0 align='absmiddle' style='height:16;width:16;' onerror='this.style.visibility=\"hidden\";'>&nbsp;&nbsp;";
					}
										
					function toggleDescription(elmnt_id) {
						if (_gel('desc_'+elmnt_id).style.display == 'none') {
							_gel('desc_'+elmnt_id).style.display = '';
							_gel('article_'+elmnt_id).className = 'descriptionHighlight';
							_gel('title_'+elmnt_id).style.backgroundColor = hex(prefs.getString('thighlight'));
							_gel('link_title_'+elmnt_id).style.color = hex(prefs.getString('tcolor'));
							_gel('title_'+elmnt_id).style.borderBottom = "1px solid #" + hex(prefs.getString('dborder'));
						} else {
							_gel('desc_'+elmnt_id).style.display = 'none';
							_gel('article_'+elmnt_id).className = '';
							_gel('title_'+elmnt_id).style.backgroundColor = '';
							_gel('link_title_'+elmnt_id).style.color = '';
							_gel('title_'+elmnt_id).style.borderBottom = '0px';
						}
						_IG_AdjustIFrameHeight();
					}
					
					if (prefs.getBool('round')) {
						var rbtop = document.createElement('div');
						rbtop.className="rbtop";
						rbtopInner = document.createElement('div');
						rbtop.appendChild(rbtopInner);
						_gel('rbroundbox').appendChild(rbtop);
					}
					
					var rbcontent = document.createElement('div');
					rbcontent.id='rbcontent';
					rbcontent.className='rbcontent';
					_gel('rbroundbox').appendChild(rbcontent);
					
					if (prefs.getBool('boxicon')) {
						_gel('rbcontent').innerHTML = '<img align="right" src="' +favicon+ '" height=50 width=50 style="position:absolute;top:5px;left:'+(document.body.scrollWidth-70)+'px;z-index:-1;" class="trans" onerror="this.style.display=\'none\';">';
					}
					
					_IG_FetchFeedAsJSON(prefs.getString("rssurl"),
						function(feed) { 
							if (feed != null) { 						
								// Access the data for a given entry
								if (feed.Entry) {
									for (var i = 0; i < feed.Entry.length; i++) {
										var custom_article = document.createElement('div');
										var custom_title = document.createElement('div');
										var custom_desc = document.createElement('div');
										var custom_date = document.createElement('div');
										var custom_link = "<div style='position:relative;left:-10px;padding-top:5px;'><a href='" + feed.Entry[i].Link + "' target='_blank' style='font-weight:" + prefs.getString('desclinkweight') + ";font-size:8pt;'>view link &raquo;</a></div>";
										
										custom_article.id = 'article_'+i;
										custom_title.id = 'title_'+i;
										custom_desc.id = 'desc_'+i;
										custom_desc.style.display='none';
										custom_date.id = 'date_'+i;
										
										switch(prefs.getString("linkaction")) {
											case "openlink":
												custom_title.innerHTML = bullet+"<a id='link_title_"+i+"' class='titlelink' target='_blank' href='" + feed.Entry[i].Link + "'>" + feed.Entry[i].Title + "</a>";
												break;
											default:
												custom_title.innerHTML = bullet+"<a id='link_title_"+i+"' class='titlelink' href='javascript:toggleDescription("+i+");'>" + feed.Entry[i].Title + "</a>";
												break;
												
										}							
										
										var milliseconds = (feed.Entry[i].Date) * 1000; 
										var date = new Date(milliseconds); 
										custom_date.innerHTML = date.toLocaleDateString() + " " + date.toLocaleTimeString();
										if (prefs.getBool('showdate')) {
											datediv = "<div style='padding:2px;position:relative;left:-10px;top:-3px;font-size:8pt;color:"+hex(prefs.getString('datecolor'))+"'><b>Date: </b>" + date.toLocaleDateString() + " " + date.toLocaleTimeString() + "</div>";
										} else {
											datediv = '';
										}
										custom_desc.innerHTML = datediv+feed.Entry[i].Summary + custom_link;
										custom_desc.className="description_off";
										custom_article.appendChild(custom_title);
										custom_article.appendChild(custom_desc);
										rbcontent.appendChild(custom_article);
                    _IG_AdjustIFrameHeight();
									}
								}
							} else {
								document.write("No feed found at " + feedurl);
							}
						},
					entries, true);
					
					if (prefs.getBool('round')) {
						rbbot = document.createElement('div');
						rbbot.className="rbbot";
						rbbotInner = document.createElement('div');
						rbbot.appendChild(rbbotInner);
						_gel('rbroundbox').appendChild(rbbot);
					}
				}
				
				//Resize Frame
				_IG_AdjustIFrameHeight();
				
			</script>
		]]> 
	</Content>
</Module>
